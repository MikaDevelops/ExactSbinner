<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exact Sbinner</title>
    <script src="./js/file_handler.js"></script>
    <script src="./js/text_to_array.js"></script>
    <script src="./js/searcher.js"></script>
    <script>
        var listArray;
        const fileHandler = new FileHandler();
        const textToArray = new TextToArray();
        const searcher = new Searcher();
        async function setList(file){
            document.getElementById('indicator').innerText="loading...";
            listArray = textToArray.makeArray(await fileHandler.loadText(file), radioCheck());
            document.getElementById('indicator').innerText="";
        }
        function enableSearchButton(){
            if (listArray && document.getElementById('search_text').value.length>0) {
                document.getElementById("search_button").removeAttribute("disabled");
            }
            else {
               document.getElementById("search_button").setAttribute("disabled", ""); 
            }     
        }
        function search(){
            document.getElementById('results').innerHTML="";
            let searchTerm = document.getElementById("search_text").value;
            let results = searcher.search(listArray, searchTerm);
            let html_text = "";
            for (let line of results){
                html_text += "<br><br>"+line;
            }
            document.getElementById('results').innerHTML=html_text;
        }
        function radioCheck(){
            if (document.getElementById('radio_json').checked) return "json";
            if (document.getElementById('radio_csv').checked) return "csv";
            if (document.getElementById('radio_csv_combined').checked) return "csv_combined";
        }
    </script>
    <style>
        .radios{
            padding-top:1.2rem;
            padding-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="navbar"><a href="make_json.html">File maker</a></div>
    <h1>Exact Sbinner</h1>
    <div class="radios">
        <input type="radio" id="radio_csv" name="radio_button_type" checked="true">
        <label for="radio_csv">6-9 digit Exact Bins CSV-file</label><br>
        <input type="radio" id="radio_csv_combined" name="radio_button_type">
        <label for="radio_csv_combined">CSV-style dataset file</label><br>
        <input type="radio" id="radio_json" name="radio_button_type">
        <label for="radio_json">Compacted JSON-file</label>
    </div>
    <div><input type="file" onchange="setList(this.files[0]);"> <span id="indicator"></span></div>
    <div>
        <input id="search_text" type="text" oninput="enableSearchButton();"> 
        <button id="search_button" onclick="search()" disabled>search</button>
    </div>
    <div id="results"></div>
</body>
</html>